<!DOCTYPE HTML>
<html>
	<head>
		<title>Administración de Servicios de Gestores de Bases de Datos.</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="shortcut icon" href="images/logo.jpg" type="image/x-icon">
		<link rel="stylesheet" href="assets/css/main.css" />
		<noscript><link rel="stylesheet" href="assets/css/noscript.css" /></noscript>
	</head>
	<body class="is-preload">

		<!-- Wrapper -->
			<div id="wrapper">

				<!-- Header -->
					<header id="header">
						<div class="logo">
							<span class="icon fa-diamond"></span>
						</div>
						<div class="content">
							<div class="inner">
								<h1>ASGBD</h1>
								<p>
									Un Sistema Gestor de Base de Datos (SGBD) o DataBase Managenent System (DBMS) es un sistema que permite la creación, 
									gestión y administración de bases de datos, así como la elección y manejo de las estructuras necesarias para el almacenamiento 
									y búsqueda de información del modo más eficiente posible.
								</p>
							</div>
						</div>
						<nav>
							<ul>
								<li><a href="#intro">Introducción</a></li>
								<li><a href="#work">Arquitectura </a></li>
								<li><a href="#usuariosyprivilegios"> Usuarios y privile</a></li>
								<li><a href="#concurrencia">Concurrencia y Bloques Oracle</a></li>
								<!--<li><a href="#elements">Elements</a></li>-->
							</ul>
							<ul>
								
								<li><a href="#exportarEimportar">Exportar e importar</a></li>
								<li><a href="#scripts">Scripts de administración de Oracle</a></li>
								<li><a href="#about">Acerca de mi</a></li>
								<li><a href="#contact">Contacto</a></li>
							</ul>
						</nav>
					</header>

				<!-- Main -->
					<div id="main">
						<!-- Intro -->
							<article id="intro">
								<h2 class="major">Intro</h2>
								<span class="image main"><img src="images/contents.jpg" width="1080" height="720" alt=""></span>
								<p>
									<ul>
										<li><a href="#instalacion">Instalación del software de base de datos</a></li>
										<li><a href="#partesBD">Instancia / listener /  base de datos</a></li>
										<li><a href="#crearInstancia">Creación de una instancia de base de datos</a></li>
										<li><a href="#crearListener">Creación de un listener</a></li>
										<li><a href="#StartStopBD">Arrancar y parar la base de datos</a></li>
										<li><a href="#ConectLocal">Conexión en local</a></li>
										<li><a href="#ConectRemote">Conexión remota</a></li>
										<li><a href="#Things">Cosas que hemos aprendido de pasada</a></li>
										<li><a href="#Resume">Diagrama resumen</a></li>
									</ul>
								</p>
							</article>
							<!-- Instalación -->
							<article id="instalacion">
							<h4 class="major"><a href="#intro">Volver atrás</a></h4>
								<h1>Instalación del software de base de datos.</h1>
								<p>
									<h2>Prerequisitos.</h2>
									<p>
										Será una máquina virtual de VirtualBox. <br>
										Fichero OVA que contiene:
										<ul>
											<li>Centos 7 -  instalado (inglés).</li>
											<li>Oracle 18c descargado.</li>
										</ul>
									</p>
									<h2>Resolver el propio nombre.</h2>
									<p>
										Cambiar el nombre de la máquina. Editamos los ficheros:
										<ul>
											<li>
												<code>
													/etc/hostname
												</code>
											</li>
											<li>
												<code>
													/etc/hosts &rarr; Hay que añadir el nombre de la máquina en 127.0.0.1 ó ::1
												</code>
											</li>
										</ul>
										Seguidamente de ello, <strong>reiniciar la máquina</strong> para guardar los cambios.
									</p>
									<h2>Entorno gráfico.</h2>
									<p>
										El instalador más cómodo de Oracle necesita un sistema de ventanas. Hay varias opciones: 
										<ul>
											<li>
												Arrancar el modo gráfico en la máquina virtual. <br>
												<code>
													startx
												</code>
											</li>
											<li>
												Conexión SSH con redirección de protocolo X11. <br>
												<code>
													ssh -X alumno@IP-servidor
												</code>
											</li>
											<li>
												Arrancar un servidor <strong>VNC</strong> en Centos. <br>
												<pre><code>sudo yum install vnc-server <br> vncserver :0</code></pre>
											</li>
										</ul>
									</p>
									<h2>Oracle 18c.</h2>
									<p>
										<h3>Descomprimir el instalador.</h3>
										<p>
											descomprimir sus ficheros en el directorio <i>$HOME/oracle-install-18c</i>
											<ul>
												<li>Sugerencia: línea de comandos <code>unzip</code></li>
												<li>Directorio $HOME/oracle-install/</li>
												<li>Fichero: LINUX.X64_180000_db_home.zip</li>
											</ul>
											Para hacer sitio,  podemos borrar los ficheros .zip una vez descomprimidos.
										</p>
										<h3>Arrancar el instalador.</h3>
										<p>
											&rarr; Se arranca con <code>./runInstaller</code>. <br>
											&rarr; Instalar sólo el software de la base de datos. <br>
											&rarr; Elegir <i>Single instance database</i>. <br>
											&rarr; Edición Enterprise.
										</p>
										<h3>Direcitorios de Oracle.</h3>
										<p>
											Dejamos los directorios por defecto:
											<ul>
												<li>Oracle Base: <code>/home/alumno/oracle-18c</code></li>
												<li>Software: <code>/home/alumno/oracle-install-18c</code></li>
												<li>
													Inventory: <code>/home/alumno/oraInventory</code>
													<ul>
														<li>dejamos el grupo a alumno</li>
													</ul>
												</li>
											</ul>
										</p>
										<h3>Grupos de Linux.</h3>
										<p>
											Elegir <i>wheel</i>. 
											<ul>
												<li>
													Es un grupo de administrador de Centos.
												</li>
												<li>
													El usuario alumno ya pertenece a él.
												</li>
											</ul>
										</p>
										<h3>Comprobaciones.</h3>
										<p>
											Ignoramos la falta de memoria.
											El instalador detectará algunos errores, pero genera unso scripts de <i>fix</i>.
											<ul>
												<li>Son parámetros del kernel de Linux.</li>
												<li>Los scripts se ejecutan como administrador.</li>
											</ul>
											Se necesitan instalar varios paquetes de software.
											<ul>
												<li><code>sudo yum install <i>paquete</i></code></li>
												<li>Es necesario que la máquina virtual tenga acceso a Internet</li>
											</ul>
											También hay un paquete de dependencias oracle-database-preinstall-18c-1.0-1.el7.x86_64.rpm),que se puede instalar con
											<code>yum localinstall</code>
										</p>
										<h3>Script de configuración</h3>
										<p>
											<code>
												/home/alumno/oraInventory/orainstRoot.sh
											</code>
											<br>
											<code>
												/home/alumno/oracle-install-18c/root.sh
											</code>
										</p>
										<h3>Finalización.</h3>
										<p>
											Necesitamos definir algunas variables de entorno (ficheros ~/.profile, ~/.bash_profile, ~/.bashrc)
											<ul>
												<li>ORACLE_HOME: /home/alumno/oracle-install-18c</li>
												<li>Incluir $ORACLE_HOME/bin en el PATH</li>
											</ul>
											También se puede usar el comando <code>oraenv</code> para definir estas variables.
										</p>
										<h3>Reiniciar.</h3>
										<p>
											En un servidor real no se hace, pero es más fácil para actualizar todas las variables de entorno. Después, podemos ver que los programas están, pero no hacen nada. 
											<br>
											<code>
												sqlplus / as sysdba
											</code>
										</p>
									</p><!-- Oracle 18c-->
								</p> <!-- Instalacion del sw de BD-->
							</article>
							<!-- Instancia, listener y base de datos -->
							<article id="partesBD">
							<h4 class="major"><a href="#intro">Volver atrás</a></h4>
								<h2>Instancia.</h2>
								<p>
									Varios procesos funcionando. Permite manipular una o varias bases de datos (En Oracle solo una).
								</p>
								<h2>Listener.</h2>
								<p>
									Proceso que admite <b>conexiones</b> de clientes.<br>
									En otros SGBD (MySQL) la instancia es su propio listener, conecta los clientes con la instancia pedida.
								</p>
								<h2>Base de datos.</h2>
								<p>
									Varios ficheros contiene datos, índices, esquema,...
								</p>
								<h2>Instancias y bases de DATOS</h2>
								<p>
									<img src="images/nstancias y bases de DATOS.PNG" width="530" height="250" alt=""> <br> Instancia y base de datos. <br>
									<img src="images/Ejemplo de listener.PNG" width="530" height="250" alt=""> <br> Ejemplo de listener.
								</p>
							</article>
							<!-- Creacion de instancia -->
							<article id="crearInstancia">
						<h4 class="major"><a href="#intro">Volver atrás</a></h4>
							<h2>Creación de una instancia de base de datos</h2>
							<p>
								Comando <code>dbca</code>.  No estará en el PATH si no se ha incluido (por ejemplo, con oraenv), utilizar la configuración típica:
								<ul>
									<li>Nombre: asir</li>
									<li>Que <strong>no sea container database</strong></li>
									<li>Recordar la contraseña</li>
								</ul>
								Guardar la información de la página de resumen.
								<h3>Password management.</h3>
								<p>
									Lista de usuarios, se puede: 
									<ul>
										<li>Bloquearse o desbloquearse.</li>
										<li>Cambiar su contraseña.</li>
									</ul>
								</p>
							</p>
							</article>
							<!-- Crear Listener-->
							<article id="crearListener">
							<h4 class="major"><a href="#intro">Volver atrás</a></h4>
								<h2>Creación de un listener</h2>
								<p>
									Permiten las conexiones de clientes remotos. Comando <code>netca</code>
								<ul>
									<li>Listener configuration</li>
									<li>Nombre del listener: LISTENER</li>
									<li>Protocolo TCP</li>
									<li>Puerto 1521</li>
								</ul>
								Comprobar la configuración creada en el fichero <code>listener.ora</code>. 
								Si luego falla, revisar <code>ADR_BASE_LISTENER</code>.
								</p>
								<h2>Arrancar y parar el listener</h2>
								<p>
									<ul>
										<li>
											<h4>Arrancar</h4> <i>lsnrctl start</i>
										</li>
										<li>
											<h4>Parar</h4> <i>lsnrctl stop</i>
										</li>
										<li>
											<h4>Comprobar si la instancia se ha conectado</h4> <i>lsnrctl status</i>
										</li>
									</ul>
								</p>
								<h2>Arrancar y parar la base de datos</h2>
								<p>
									Se necesitan las variables <i>ORACLE_HOME, ORACLE_SID, PATH, ORACLE_BASE</i>. 
									Se definen <strong>manualmente</strong> con ayuda del script <i>oraenv.</i> <br>
									<p>
										<code>
											source oraenv
										</code>
									</p>
									Arrancar y parar la base de datos. <br>
									<code>
										dbstart $ORACLE_HOME 
									</code>
									<code>
										dbshut $ORACLE_HOME
									</code>
									Arrancar y parar el listener. Comprobar que se admiten conexiones. 
<pre><code>lsnrctl start
lsnrctl stop
lsnrctl status</code></pre>
								</p>
							</article>
							<!-- Conexion local-->
							<article id="ConectLocal">
							<h4 class="major"><a href="#intro">Volver atrás</a></h4>
								<h2>Conexión en local</h2>
								<p>
									Después de la creación de un listener y una instancia, ya podemos conectarnos a la base de datos.
									Recordatorio: Debemos tener configuradas las variables de entorno.
									<ul>
										<li>ORACLE_SID:El nombre que de a la base de datos (asir)</li>
										<li>PATH:Debe incluir $ORACLE_HOME/bin</li>
										<li>Se puede poner también con <code>oraenv</code></li>
									</ul>
									<code>sqlplus / as sysdba</code>
								</p>
							</article>
							<!-- Conexión remota -->
							<article id="ConectRemote">
								<h4 class="major"><a href="#intro">Volver atrás</a></h4>
								<h2>Acceso por redes</h2>
								<p>
									Es necesario conocer la IP de nuestro servidor. 
									<ul>
										<li><code>ifconfig</code></li>
										<li><code>hostname -I</code></li>
										<li><code>ip a</code></li>
									</ul>
									Es necesario que el ordenador cliente pueda acceder al servidor. 
									<ul>
										<li>Tipo de conexión de la máquina virtual: mejor <i>bridged</i></li>
										<li>ping</li>
										<li>Firewall: <code>systemctl disable firewalld</code></li>
									</ul>
									<h3>Conexión remota</h3>
									<p>
										Es necesario conocer la IP o nombre del ordenador remoto, si nos fiamos de DHCP, cada día puede ser una IP distinta. 
										Es mejor usar un nombre:
										<ul>
											<li>DNS: Muy difícil</li>
											<li>Nombres netbios de Windows</li>
											<li>Nombres zerocconf/avahi de Linux/Mac</li>
										</ul>
										<h3>Avahi</h3>
										<p>
											Instalar <i>avahi</i> y <i>avahi-tools</i>. Activar opciones <i>publish-hinfo</i> y <i>publish-workstation</i>. 
											Desactivar el firewall, importante: el nombre afecta al fichero <i>listener.ora</i>. <br>
											El nombre de red será  el que tengamos más .local. Por ejemplo: <br>
											<code>
												alumnoASGBD.local
											</code>
											Con esto un Windows puede encontrar a un linux. Para que Linux encuentre a otro linux, hay que cambiar <code>/etc/nsswitch.conf</code>
											En <strong>Centos</strong>, hay que instalar <code>nss_mdns</code>.
										</p>
										<h3>Samba</h3>
										<p>
											<a href="https://www.howtoforge.com/samba-server-installation-and-configuration-on-centos-7" target="_blank" rel="noopener noreferrer">Instalar y conf. Samba en Centos 7</a>
<pre><code>
sudo yum install -y samba samba-client samba-common 
systemctl enable smb.service 
systemctl enable nmb.service
</code></pre>
											Cambiar el fichero <code>smb.conf</code>, el <code>netbios name</code> &rarr; Máximo 15 caracteres, sin guiones. <br>
											<strong>Importante:</strong>el nombre afecta al fichero <i>listener.ora</i>
										</p>
										<h3>Acceso via Web</h3>
										<p>
											Al crear la base de datos con <i>dbca</i> se configura el acceso <b>Enterprise Manager.</b> <br>
											<blockquote>
												URL: https://nombre-o-ip:5000/em/
											</blockquote> <br>
											Tenemos IP dinámica, por lo que debemos configurar una resolución por nombre. 
											<ul>
												<li>DNS es complicado</li>
												<li>Usaremos avahi entre linux y samba entre linux y Windows</li>
											</ul>
										</p>
									</p>
								</p>
								<h2>Instalación de sqlplus</h2>
								<p>
									El cliente sqlplus viene en la instalación de Oracle, pero tambiñen puede instalarse por separado. <br>
									<ul>
										<li><a href="http://www.oracle.com/technetwork/topics/linuxx86-64soft-092277.html" target="_blank" rel="noopener noreferrer">Instalar SQLPLUS Client (Linux)</a></li>
										<li><a href="https://download.oracle.com/otn_software/linux/instantclient/193000/instantclient-basic-linux.x64-19.3.0.0.0dbru.zip" target="_blank" rel="noopener noreferrer">Descargar Instancia Client para Linux </a></li>
										<li><a href="https://download.oracle.com/otn_software/linux/instantclient/193000/instantclient-sqlplus-linux.x64-19.3.0.0.0dbru.zip" target="_blank" rel="noopener noreferrer">Descargar Sqlplus Client Linux</a></li>
									</ul>
									Tras descomprimir, hay que definir las variables ORACLE_HOME y LD_LIBRARY_PATH al directorio de instalación. Puede ser necesaria la librería <code>libaio</code> <br>
									Para conectarse:
									<p>
										<code>
											sqlplus username/password@host:port/service
										</code> <br>
										<code>
											sqlplus sys/alumno@centos7.local/asir as sysdba
										</code>
									</p>
								</p>
								<h2>Instalación de SQLDeveloper en Centos.</h2>
								<p>
									Se necesita JDK 1.8, se instalan los ficheros <i>sqldeveloper-4.1.5.21.78-1.noarch.rpm</i> y <i>jdk-8u111-linux-x64.rpm</i>
									<br>
									<a href="http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html" target="_blank" rel="noopener noreferrer">Descargar JDK 8</a>
									<br>
									<a href="http://www.oracle.com/technetwork/developer-tools/sql-developer/downloads/index.html" target="_blank" rel="noopener noreferrer">Descargar SQL Developer </a>
									<br>
									Arrancar sqldeveloper desde consola - preguntará por el directorio de instalación del JDK.
								</p>
								<h2>Instalación de SQLDeveloper en Ubuntu</h2>
								<p>
									Se necesita JDK 1.8. <br>
									Se descarga el fichero <a href="http://www.oracle.com/technetwork/developer-tools/sql-developer/downloads/index.html" target="_blank" rel="noopener noreferrer"> <i>sqldeveloper-xxxx-no-jre.zip</i></a>
									<br>
									Se descomprime y se ejecuta sqldeveloper.sh
								</p>
							</article>
							<!-- Cosas que hemos aprendido de pasada. -->
							<article id="Things">
								<h4 class="major"><a href="#intro">Volver atrás</a></h4>
								<h2>Cosas que hemos aprendido de pasada</h2>
								<p>
									<ul>
										<li>Variables de entorno - Variable <b>PATH</b></li>
										<li>Conexiones por <b>ssh</b> - Con redirección del <b>Xserver</b></li>
										<li>Edición de ficheros de texto</li>
										<li>Instalación de paquetes en Centos</li>
										<li>Conexiones de red (bridged,NAT)</li>
										<li>Elevación de permisos con <i>sudo</i></li>
										<li>Descompresión de ficheros ZIP</li>
									</ul>
									Nada de esto es directamente base de datos pero ja sido necesario para instalar Oracle.
									<h3>Comandos</h3>
									<p>
										<table>
											<tr>
												<td>cd</td>
												<td>Cambia el direcotrio actual</td>
											</tr>
											<tr>
												<td>echo</td>
												<td>Escribe los parámetros pasados</td>
											</tr>
											<tr>
												<td>df</td>
												<td>Espacio de disco usado</td>
											</tr>
											<tr>
												<td>unzip</td>
												<td>Descomprimir un zip</td>
											</tr>
											<tr>
												<td>updatedb</td>
												<td>Actualiza la lista de ficheros de disco</td>
											</tr>
											<tr>
												<td>locate</td>
												<td>Busca un fichero la lista de <i>updatedb</i></td>
											</tr>
											<tr>
												<td>ssh</td>
												<td>Conexión remota</td>
											</tr>
											<tr>
												<td>grep</td>
												<td>Busca líneas con un texto</td>
											</tr>
											<tr>
												<td>nano</td>
												<td>Editor de ficheros</td>
											</tr>
											<tr>
												<td>netstat</td>
												<td>Ver conexiones de red</td>
											</tr>
											<tr>
												<td>nc</td>
												<td>Conectar por TCP o UDP</td>
											</tr>
											<tr>
												<td>$var</td>
												<td>Valor de una variable (de export y env)</td>
											</tr>
											<tr>
												<td>|</td>
												<td>Manda la salid de un programa a la entrada de otro</td>
											</tr>
											<tr>
												<td>$HOME/.bashrc</td>
												<td>Script de inicio del usuario</td>
											</tr>
											<tr>
												<td>source</td>
												<td>Ejecuta un script dento de la shell actual</td>
											</tr>
											<tr>
												<td>export</td>
												<td>Define una variable</td>
											</tr>
											<tr>
												<td>env</td>
												<td>Lista de variables</td>
											</tr>
											<tr>
												<td>PATH</td>
												<td>Lista de directorios donde se buscan comandos</td>
											</tr>
											<tr>
												<td>history</td>
												<td>Lista de comandos introducidos en la shell</td>
											</tr>
										</table>
									</p>
								</p>
							</article>
							<!-- Resumen -->
							<article id="Resume">
								<h4 class="major"><a href="#intro">Volver atrás</a></h4>
								<h2>Diagrama resumen</h2>
								<p>
									<img src="images/esquema-resumen.PNG" width="630" height="1050" alt="">
								</p>
							</article>
							<!-- Work Schema - Arquitecture -->
							<article id="work">
								<h2 class="major">Arquitectura de Oracle.</h2>
								<span class="image main"><img src="images/schema.jpg" width="850" height="480" alt="" /></span>
								<p>
									<ul>
										<li><a href="#arquitectura">Arquitectura</a></li>
										<li><a href="#arranqueyparada">Arranque y parada</a></li>
										<li><a href="#vistas">Vistas</a></li>
										<li><a href="#bibliografia">Bibliografía</a></li>
									</ul>
								</p>
							</article>
							<!-- Arquitectura -->
							<article id="arquitectura">
								<h4 class="major"><a href="#work">Volver atrás</a></h4>
								<h2>Arquitectura</h2>
								<p>
									Oracle es un sistema complejo. Para hacerlo más seguro, sus tareas se distribuyen entre muchos procesos. Si un procesp falla, los demás pueden intentar seguir trabajando. <br>
									<img width="850" height="480"src="images/arquitectura.PNG" alt="">
									<h3>Algunos procesos.</h3>
									<p>
										<table>
											<tr>
												<td>PMON(Process MONitor)</td>
												<td>Monitor de procesos, se encarga de controlar los otros procesos en background y de recuperarlos cuando uno de ellos falla.</td>
											</tr>
											<tr>
												<td>SMON(System MONitor Process)</td>
												<td>Recupera transacciones. realiza tareas de limpieza: recuperar segmentos temporales, combinar extensiones contiguas y disponibles,...</td>
											</tr>
											<tr>
												<td>DWBn (Database Writer Process)</td>
												<td>Escribe  el contenido de los buffers en los datafiles. n puede ser 0,1,...,9,a,...,j</td>
											</tr>
											<tr>
												<td>LGWR(Log Writer Process)</td>
												<td>Gestión del buffer de redo, escribiendo su contenido en los archivos log.</td>
											</tr>
											<tr>
												<td>CKPT(ChecKPoinT Process)</td>
												<td>Actualiza los datafiles y el fichero de control cuando se establece un punto de control (checkpoint).</td>
											</tr>
											<tr>
												<td>RECO (RECOverer Process)</td>
												<td>Necesario ante fallos en transacciones distribuidas.</td>
											</tr>
										</table>
									</p>
									<h3>SGA y PGA.</h3>
									<p>
										<strong>PGA.</strong>Program Global Area. Es la zona de memoria dedicada a un proceso. <br>Global: si admite mñas de una conexión, se comparte entre conexiones. <br>
										<strong>SGA.</strong>System Global Area. Memoria compartida entre todos los procesos de Oracle. <br>
										<img width="850" height="480"src="images/SGAyPGA.PNG" alt="">
									</p>
									<h3>Procesos de usuario y procesos de sistema.</h3>
									<p>
										Los procesos de usuario no se conectan directamente a la SGA. Oracle crea procesos intermedios para aislarlos. <br>
										<img width="850" height="480"src="images/SGA-Diagram.PNG" alt="">
									</p>
								</p>
							</article>
							<!-- Arranque y parada -->
							<article id="arranqueyparada">
								<h4 class="major"><a href="#work">Volver atrás</a></h4>
								<h2>Arranque y parada.</h2>
								<p>
									Oracle tiene varios estados. 
									<table>
										<tr>
											<td><strong>Shutdown</strong></td>
											<td>Todo parado</td>
										</tr>
										<tr>
											<td><strong>Nomount</strong></td>
											<td>Memoria compartida reservada</td>
										</tr>
										<tr>
											<td><strong>Mount</strong></td>
											<td>Fichero de control abierto</td>
										</tr>
										<tr>
											<td><strong>Open</strong></td>
											<td>Fichero de datos abierto. Los clientes pueden conectarse.</td>
										</tr>
									</table>
									<img width="850" height="480"src="images/status.PNG" alt="">
								</p>
								<h3>¿Por qué tantos modos?</h3>
								<p>
									<strong>Shutdown y open</strong> son los modos habituales. <br>
									<strong>Nomount</strong> para recuperar la base de datos de errores(si falta algún fichero). <br>
									<strong>Mount</strong> para habilitar y deshabilitar el redo log. Para recuperar la base de datos de errores (sin usuarios)
									<cite>
										Conclusión: con suerte, solo <strong>shutdown</strong> y <strong>open.</strong>
									</cite>
								</p>
							</article>
							<!-- Vistas -->
							<article id="vistas">
								<h4 class="major"><a href="#work">Volver atrás</a></h4>
								<h2>Vistas.</h2>
								<p>
									En un sistema relacional, toda la información se guarda en forma de relaciones. Las vistas son representaciones de otras vistas o relaciones. 
									<ul>
										<li>Quitando algunas filas o columnas.</li>
										<li>Uniendo unas tablas con otras.</li>
									</ul>
									Tanto las tablas como las vistas son relaciones.
								</p>
								<h3>Vistas de Oracle</h3>
								<p>
									La información acerca de la base de datos también se almacena en relaciones de la base de datos. Generalmente, en forma de vistas. Ejemplos: 
									<ul>
										Tablas: nombres, propietario,... <br>
										Campos de las tablas: Nombre, tipo, longitud,... <br>
										Restricciones <br>
										Usuarios: nombre, contraseñas,... <br>
										Tablespaces
									</ul>
									<h3>Tipos de vistas de Oracle.</h3>
									<p>
										<ul>
											<li>
												<strong>Estáticas.</strong>
												Cambian solo si se produce un cambio en los objetos de la base de datos (tablas, vistas, usuarios,...) <br>
												<code>
													create, alter, drop, grant, revoke, ... 
												</code> <br>
												Documentación de Oracle: 
												<ul>
													<li><a href="https://docs.oracle.com/cd/B19306_01/server.102/b14237/statviews_2.htm#CCHHHJIF" target="_blank" rel="noopener noreferrer">Vistas Estáticas 1</a></li>
													<li><a href="https://docs.oracle.com/cd/B19306_01/server.102/b14237/statviews_3.htm#g1720197" target="_blank" rel="noopener noreferrer">Vistas Estáticas 2</a></li>
													<li><a href="https://docs.oracle.com/cd/B19306_01/server.102/b14237/statviews_4.htm#BABDFHFI" target="_blank" rel="noopener noreferrer">Vistas Estáticas 3</a></li>
												</ul>
											</li>
											<li>
												<strong>Dinámicas.</strong>
												Actualizadas constantemente. Usuarios conectados, memoria disponible, consultasa en curso,... <br>
												<a href="https://docs.oracle.com/cd/B19306_01/server.102/b14237/dynviews_1.htm" target="_blank" rel="noopener noreferrer">Vistas Dinámicas - Oracle</a>
											</li>
										</ul>
										<table>
											<tr>
												<td>USER_XXX</td>
												<td>Estática</td>
												<td>Acerca de los objetos propiedad del usuario</td>
											</tr>
											<tr>
												<td>ALL_XXX</td>
												<td>Estática</td>
												<td>Objetos que puede acceser el usuario</td>												
											</tr>
											<tr>
												<td><a href="https://sqljana.wordpress.com/2016/12/21/oracle-data-dictionary-views-user-vs-all-vs-dba-views-100-level-basics/" target="_blank" rel="noopener noreferrer">DBA_XXX</a></td>
												<td>Estática</td>
												<td>Todos los objetos de la base de datos <a href="https://sqljana.wordpress.com/2016/12/21/oracle-data-dictionary-views-user-vs-all-vs-dba-views-100-level-basics/" target="_blank" rel="noopener noreferrer">(*)</a></td>												
											</tr>
											<tr>
												<td>V$XXX</td>
												<td>Dinámica</td>
												<td>Información dinámica de la instancia</td>												
											</tr>
											<tr>
												<td>GV$XXX</td>
												<td>Dinámica</td>
												<td>Información dinámica del cluster</td>													
											</tr>
										</table>
										<strong> Vista comodín:
											<blockquote>
												<code>		
													select * from dict;
												</code>
											</blockquote>
										</strong>
										<h3>Ejemplos de vistas: ficheros.</h3>
										<p>
											<ul>
												<li>
													<strong>Tipo de archivo:</strong> &rarr; De Datos (dbf) undo,system y users.<br>
													<strong>Vista:</strong>
													<blockquote>
														<code>
															v$datafile
														</code>
													</blockquote>
												</li>
												<li>
													<strong>Tipo de archivo:</strong> &rarr; Temporales (tmp).<br>
													<strong>Vista:</strong>
													<blockquote>
														<code>
															v$tempfile
														</code>
													</blockquote>
												</li>
												<li>
													<strong>Tipo de archivo:</strong> &rarr; Rehacer o Redo Log (log).<br>
													<strong>Vista:</strong>
													<blockquote>
														<code>
															v$logfile, v$log
														</code>
													</blockquote>
												</li>
												<li>
													<strong>Tipo de archivo:</strong> &rarr; De control. Estructura física de la BD.<br>
													<strong>Vista:</strong>
													<blockquote>
														<code>
															v$controlfile
														</code>
													</blockquote>
												</li>
												<li>
													<strong>Tipo de archivo:</strong> &rarr; De log.<br>
													<strong>Vista:</strong>
													<blockquote>
														<code>
															v$diag_info
														</code>
													</blockquote>
												</li>
												<li>
													<strong>Tipo de archivo:</strong> &rarr; Información de la BD.<br>
													<strong>Vista:</strong>
													<blockquote>
														<code>
															v$database
														</code>
													</blockquote>
												</li>
											</ul>
										</p> <!-- Ejemplos de vistas -->
									</p> <!-- Tipos de vistas de Oracle -->
								</p> <!-- Vistas de Oracle -->
								<h3>Archivos</h3>
								<p>
									Los datos de las tablas al final se almacenan en archivos. 
									<table>
										<tr>
											<td>
												Archivos de datos, de usuarios y del sistema.
											</td>
											<td>
												En tablespaces (dbf).
											</td>
										</tr>
										<tr>
											<td>
												Redo log (registro de todas las transacciones).
											</td>
											<td>
												log
											</td>
										</tr>
										<tr>
											<td>
												Archivos de control.
											</td>	
											<td>
												ctl
											</td>
										</tr>
									</table>
								</p> <!-- Archivos -->
							</article>
							<!-- Bibliografía -->
							<article id="bibliografia">
								<h4 class="major"><a href="#work">Volver atrás</a></h4>
								<h2>Bibliografía.</h2>
								<p>
									<a href="https://docs.google.com/document/d/1CV-Sk9I0Pvra85IrBLjzCDA2M-nn82kziJJQBhvYMq8/edit" target="_blank" rel="noopener noreferrer">Introducción a Oracle</a>
									<br>
									<a href="https://docs.google.com/presentation/d/1pIrg5ZfTOr_j_MxBSMW3pl6jmabko_zvoAJ2ktXPis8/edit" target="_blank" rel="noopener noreferrer"> Vistas de Oracle</a>
								</p>
							</article>
							<!-- Usuarios y privilegios -->
							<article id="usuariosyprivilegios">
								<h2>Usuarios, privilegios y roles de Oracle</h2>
								<p>
									<h3>Introducción</h3>
									<p>
										Oracle puede usarse simultáneamente por varios procesos y clientes. Cada uno puede tener distintos permisos y capacidades. 
										<ul>
											<li>Espacio de disco disponible.</li>
											<li>Gasto de CPU, red.</li>
											<li>Acceso a diferentes tablas de datos.</li>
										</ul>
									</p>
									<h3>Tablespaces</h3>
									<p>
										Oracle almacena datos en los tablespaces. 
										<blockquote>
											Conjuntos de ficheros. <br>
											Normas para su tamaño: inicial, máxim, crecimiento
										</blockquote>
										Cada tablespace puede usarse para diferentes funciones.
										<ul>
											<li>Datos de usuario o del sistema: <i>permanent tablespace</i></li>
											<li>Datos de recuperación: <i>undo tablespace</i></li>
											<li>Datos temporales: <i>temporary tablespace</i></li>
										</ul>
										<h4>¿Por qué tantas normas?</h4>
										<p>
											<ul>
												<li>
													<strong>Disponibilidad</strong> 
													<ul>
														<li>
															Es mejor garantizar el espacio para las tablas.
														</li>
														<li>
															Es mejor ahorrar espacio mientras se pueda.
														</li>
													</ul>
												</li>
												<li>
													<strong>Velocidad</strong>
													<ul>
														<li>
															Hacer crecer un fichero es lento.
														</li>
														<li>
															Un fichero que ha crecido poco a poco está disperso en el disco (y es más lento)
														</li>
													</ul>
												</li>
												<li>
													<strong>Capacidad</strong> <br>
													Cada sistema de ficheros tiene un tamaño de fichero máximo.
												</li>
											</ul>
										</p> <!-- Porqué tantas normas-->
										<h4>Tablespaces por defecto &Rarr;(USSUT)</h4>
										<p>
											Por defecto, Oracle crea en una nueva base de datos: 
											<ul>
												<li>
													<strong>[U]sers:</strong> Tablespace asignado por defecto para los <b>datos de todos los usuarios.</b>
												</li>
												<li>
													<strong>[S]ystem:</strong> Datos acerca de la <b>instancia y del diccionario de datos.</b>
												</li>
												<li>
													<strong>[S]ysaux:</strong> <b>Operaciones temporales del administrador</b> que no caben en memoria.
												</li>
												<li>
													<strong>[U]ndo(undotbs1):</strong> Datos para deshacer las transacciones(<b>rollback</b>).
												</li>
												<li>
													<strong>[T]emp:</strong> <b>Operaciones temporales de usuarios</b> que no caben en memoria.
												</li>
											</ul>
											Ver tablespaces por defecto en SQLPLUS:
											<code>
												select tablespace_name, contents from dba_tablespaces;
											</code>
										</p>
										<h4>Crear un tablespace</h4>
										<p>
<pre><code>CREATE TABLESPACE <i>nombre</i>
 DATAFILE 'ruta/al/fichero.dbf'
 AUTOEXTEND ON 
 NEXT 200k
 MAXSIZE 2048k;
</code></pre>										
										</p>
										<h4>¿Por qué es tan complicado?</h4>
										<p>
											Esta flexibilidad permite: 
											<ul>
												<li>
													Que cada usuario tenga sus tablespaces
												</li>
												<li>
													Que cada tablespace esté en discos distintos (rapidez)
												</li>
												
												<li>
													Que un tablespace se localice en varios discos (rapidez, tamaño) 
												</li>
												<li>
													Mover tablespaces una vez creados 										
												</li>
											</ul>
										</p>
										<h4>Conceptos de almacenamiento.</h4>
										<p>
											<a href="images/conceptosdealmacenamiento.PNG"><img src="images/conceptosdealmacenamiento.PNG" width="73%" alt=""></a>
										</p>
									</p> <!-- tablespaces-->
									<h3>Usuarios</h3>
									<p>
										Oracle tiene dos modos de autentificar usuarios. 
										<ul>
											<li>Autentificación de sistema operativo.</li>
											<li>Autentificación con seguridad nativa oracle</li>
										</ul>
										Al instalarlo, elegimos que el grupo <i>wheel</i> era administrador.
										<h4>Creación de usuarios</h4>
										<p>
<pre><code>CREATE USER <i>usuario</i> IDENTIFIED BY <i>contraseña</i>
DEFAULT TABLESPACE tablespace
TEMPORARY TABLESPACE tablespaceTemporal 
QUOTA UNLIMITED ON tablespace 
QUOTA tamaño ON tablespace 
ACCOUNT lock/unlock
</code></pre>
										</p>
										<h4>Modificación de usuario</h4>
										<p>
											<ul>
												<li>
													Modificación de un usuario ya creado. <br>
													<code>
														ALTER USER usuario CUALQUIER OPCION VALIDA AL CREAR USUARIO;
													</code>
												</li>
												<li>
													Borrado de usuario. <br>
													<code>
														DROP USER usuario;
													</code>
												</li>
											</ul>
										</p>
									</p> <!-- Usuarios -->
									<h3>Privilegios</h3>
									<p>
										Cada usuario puede tener unos permisos distintos. Ya hemos visto dos permisos. 
										<ul>
											<li>En qué tablespace se puede escribir</li>
											<li>Cuántos datos se pueden escribir en esos tablespaces</li>
											<li>Si una cuenta está bloqueada</li>
										</ul>
										Pero hay más permisos. 
										<table>
											<tr>
												<td><strong>Privilegio</strong></td>
												<td><strong>Objeto sobre el que se aplica</strong></td>
											</tr>
											<tr>
												<td>
													<i>create,alter,drop</i>
												</td>
												<td>
													table,sequence,view,user,synonym,session
												</td>
											</tr>
											<tr>
												<td>
													<i>select,update,delete,insert</i>
												</td>
												<td>
													Sobre campos de tablas y filas.
												</td>
											</tr>
										</table>
									<h4>Sintaxis de <i>Grant</i></h4>
									<p>
<pre><code>grant PRIVILEGIO1,PRIVILEGIO2,...PRIVILEGION 
on OBJETO 
to USUARIO 
<i>with GRANT OPTION</i>;
<hr>
create table alumnos(...);
create user profesor ...; 
grant select on <b>alumnos</b> to <b>profesor</b>;
</code></pre>											
										</p>
										<h4>Quitar privilegios</h4>
										<p>
											Los privilegios se quitan con <code>revoke</code>. <br>
											Cuando un usuario pierde un privilegio, lo pierden también todos los que recibieron el mismo privilegio a través de él. 
											Por la cláusula <i>with grant option.</i>
<pre><code>connect sys/**** 
grant select on tabla1 to usuario1 with grant option; 
<hr>
connect usuario1/*** 
grant select on tabla1 to usuario2; 
<hr>
connect sys/**** 
<strong>revoke </strong> select on tabla1 from usuario1;
</code></pre>											
											Aquí ni usuario1 ni usuario2 tienen privilegios sobre la tabla1.
										</p>
									</p> <!-- Privilegios -->
									<h3>Roles</h3>
									<p>
										Asignar todos los privilegios a un usuario es trabajoso, pero factible. 
										Qué ocurre si tenemos que manejar a muchos usuarios?
										Los roles permiten dar nombre a un grupo de privilegios. 
										<ul>
											<li>Se pueden asignar privilegios a un rol.</li>
											<li>Y después asignar ese rol a varios usuarios.</li>
										</ul>
										<h4>Sintaxis de roles</h4>
										<p>
<pre><code>CEATE ROLE nombrerole;
GRANT privilegios ON objeto TO nombrerole;
GRANT nombrerole TO usuario1;
GRANT nombrerole TO usuario2;
...
GRANT nombrerole TO usuarion;
</code></pre>											
										</p>
									</p> <!-- Roles -->
									<h3>Perfiles</h3>
									<p>
										Un <i>profile</i> es un conjunto de limitaciones sobre el sistema <strong>Oracle.</strong> <br>
										No limita acceso a datos, sino al propio SGBD y sistema operativo.
										<h4>Creación de perfiles</h4>
										<p>
<pre><code>CREATE PROFILE nombreperfil LIMIT 
	session_per_user			UNLIMITED
	cpu_per_session				UNLIMITED
	cpu_per_call				30000 
	connect_time				45 
	idle_time				300 
	logical_reads_per_session	 	DEFAULT
	logical_reads_per_call			1000
	private_sga				15K 
	composite_limit				5000000; 
ALTER SYSTEM SET resource_limit = TRUE scope = BOTH
</code></pre>											
										</p>
										<h4>Asignación de perfil a un usuario</h4>
										<p>
											En la creación (create user), o posteriormente. <br>
											<code>
												alter user USUARIO profile NOMBREDELPERFIL;
											</code>
										</p>
									</p> <!-- Perfiles -->
								</p>
							</article>
							<!-- Concurrencua y bloqueos en Oracle -->
							<article id="concurrencia">
								<h2>Introducción</h2>
								<p>
									Oracle es un servidor de base de datos, idealmente, cada usuario debería poder usar la base de datos como si fuera para él en exclusica (ACID). Más de un usuario, y más de un cliente por usuario, 
									puede utilizar a la vez el servidor. Problemas:
									<ul>
										<li>Bloqueos de tablas.</li>
										<li>Auditoría de conexiones.</li>
									</ul>
								</p>
								<!-- ACID -->
								<h2>Propiedades ACID</h2>
								<p>
									<table>
										<tr>
											<td><b>Atomicidad</b></td>
											<td>Un conjunto de cambios se realiza en su totalidad, o no se realiza ninguno.</td>
										</tr>
										<tr>
											<td><b>Consistencia</b></td>
											<td>Las reglas de los datos (constraints) se respetan.</td>
										</tr>
										<tr>
											<td><b>Aislamiento</b></td>
											<td>Cada usuario puede trabajar considerando que es el único que usa la BD.</td>
										</tr>
										<tr>
											<td><b>Durabilidad</b></td>
											<td>Una vez grabada una modificación, persistirá aunque ocurra algún fallo posterior.</td>
										</tr>
									</table>
								</p>
								<!-- Atomicidad -->
								<h2>Atomicidad</h2>
								<p>
									Algunos cambios deben producirse juntos. Ejemplo: <br>
									<blockquote><code>
										Una transferencia bancaria debe restar de una cuenta y sumar en otra
									</code></blockquote>
									El conjunto de cambios es una transacción.
									<blockquote><code>
										Una transacción empieza cuando acaba la siguiente. <br>
										Termina con: 
									</code>
										<ul>
											<li><b>commit</b> Los cambios se guardan</li>
											<li><b>rollback</b> Ningún cambio se guarda</li>
											<li>Desconexión o error - generalmente, equivalente a rollback</li>
										</ul></blockquote>
								</p>
								<!-- Consistencia -->
								<h2>Consistencia</h2>
								<p>
									Los datos deben ser coherentes con el modelo de datos. Se usan restricciones (constrains).
									<ul>
										<li>primary key</li>
										<li>unique</li>
										<li>foreign key</li>
										<li>check</li>
										<li>Incluso triggers (scripts del gestor de BD)</li>
									</ul>
									No hay forma de saltarse una constrains, más allá de eliminarla (drop).
								</p>
								<!-- Aislamiento -->
								<h2>Aislamiento (isolation)</h2>
								<p>
									Objetivos:
									<ul>
										<li>Cada usuario debe poder trabajar como si fuera el único.</li>
										<li>Pero al mismo tiempo los datos deben poder accederse concurrentemente.</li>
									</ul>
									Esto supone llegar a un compromiso:
									<ul>
										<li>Cuanto más <i>aislamiento</i> menos <i>concurrencia.</i></li>
										<li>Cuanto más <i>concurrencia</i> menos <i>aislamiento.</i></li>
									</ul>
									Estos problemas los trataremos más adelante.
								</p>
								<!-- Durabilidad -->
								<h2>Durabilidad</h2>
								<p>
									Las bases de datos garantizan tras la vuelta de <i>commit</i> que:
									<ul>
										<li>Los datos han sido grabados a soporte no volátil</li>
										<li>Los datos son recuperables por este y otros usuarios</li>
									</ul>
								</p>
								<!-- Problemas del uso concurrente -->
								<h2>Problemas de uso concurrente</h2>
								<p>
									Idealmente, cada usuario debería trabajar sin notar que otros usuarios usan a la vez la base de datos. Debido a otras transacciones, pueden presentarse los siguientes problemas:
									<table>
										<tr>
											<td>
												Lectura sucia
											</td>
											<td>
												Dirty read
											</td>
											<td>
												Un usuario lee datos aún no confirmados.
											</td>
										</tr>
										<tr>
											<td>
												Lectura no repetible
											</td>
											<td>
												Repeatable read
											</td>
											<td>
												Un usuario lee menos filas (o filas cambiadas) en select  sucesivas dentro de la transacción
											</td>
										</tr>
										<tr>
											<td>
												Fila Fantasma
											</td>
											<td>
												Phanton read
											</td>
											<td>
												Un usuario lee más filas en select sucesivas dentro de la misma transacción.
											</td>
										</tr>
									</table>
								</p>
								<!-- Nivel de aislamiento/concurrencia -->
								<h2>Nivel de aislamiento/concurrencia</h2>
								<p>
									<table>
										<tr>
											<td>	
												<strong>Problema</strong>
											</td>
											<td>
												<strong>Nivel de aislamiento</strong>
											</td>
										</tr>
										<tr>
											<td>	
												Lectura sucia
											</td>
											<td>
												Read Oncommited (Oracle no lo tiene)
											</td>
										</tr>
										<tr>
											<td>
												Lectura no repetible
											</td>
											<td>
												Repeatable read (Oracle no lo tiene)
											</td>
										</tr>
										<tr>
											<td></td>
											<td>
													Read committed (por defecto en Oracle)
											</td>
										</tr>
										<tr>
											<td>	
												Fila Fantasma
											</td>
											<td>
												Serializable
											</td>
										</tr>
									</table>
								</p>
								<!-- Datos de pruebas -->
								<h2>Datos de pruebas</h2>
								<p>
<pre><code>create table ALUMNOS (dni varchar(10), nombre varchar(10));
insert into ALUMNOS values('1', 'nom1');
insert into ALUMNOS values('2', 'nom2');
insert into ALUMNOS values('3', 'nom3');
</code></pre>		
								</p>
								<!-- Lectura no repetible -->
								<h2>Lectura no repetible</h2>
								<p>
									<table>
										<tr>
											<td>Conexión 1.</td>
											<td>Conexión 2.</td>
										</tr>
										<tr>
											<td>
<pre>
set transaction isolation level 
read committed 
select * from alumnos 

select * from alumnos 
(aún no se ve el cambio, sería un alectura sucia)

select * from alumnos
(ahora se ve el cambio, es una lectura no repetible)
rollback
</pre>
											</td>
											<td>
<pre>
set transaction isolation level 
read commited 
select * from alumnos
update alumnos set nombre='nom1' where dni='3'


commit 
</pre>
											</td>
										</tr>
									</table>
								</p>
								<!-- Fila fantasma -->
								<h2>Fila fantasma</h2>
								<p>
									<table>
										<tr>
											<td>Conexión 1.</td>
											<td>Conexión 2.</td>
										</tr>
										<tr>
											<td>
<pre>
set transaction isolation level 
read commited
select * from alumnos


select * from alumnos 
(La conex.1 leerá más alumnos en la segunda 'select', 
una fila fantasma)
rollback
</pre>												
											</td>
											<td>
<pre>
set transaction isolation level
read commited 

insert into ALUMNOS values ('4', 'nom4')
commit
</pre>												
											</td>
										</tr>
									</table>
								</p>
								<!-- Bloqueos y versiones -->
								<h2>Bloqueos y versiones</h2>
								<p>
									La orden <code>set isolation level </code> indica a la base de datos que bloquee filas, campos o tablas. Al bloquearse, los demás usuarios no pueden acceder hasta que la transacción no termine.
									<ul>
										<li>commit</li>
										<li>rollback</li>
									</ul>
									Los bloqueos garantizan que no se producen los problemas correspondientes al nivel de aislamiento.
									<ul>
										<li><code>read commited</code></li>
										<li><code>serializable</code></li>
									</ul>
									Las versiones hacen que una transacción vea solo una fotografía del estado de la base de datos, la transacción no se ve afectada por cambios posteriores a su inicio.
								</p>
								<!-- Lectura no repetible evitada -->
								<h2>Lectura no repetible evitada</h2>
								<p>
									<table>
										<tr>
											<td>Conexión 1</td>
											<td>Conexión 2</td>
										</tr>
										<tr>
											<td>
<pre>
set transaction isolation level
serializable 
select * from alumnos

select * from alumnos 
(No se ve el cambio, sería una lectura sucia)

select * from alumnos 
(El cambio no se ve, sería lectura no repetible)
rollback
</pre>
											</td>
											<td>
<pre>



update alumnos set nombre='nom2' where dni=3


commit
</pre>
											</td>
										</tr>
									</table>
								</p>
								<!-- Fila fantasma evitada -->
								<h2>Fila fantasma evitada</h2>
								<p>
									<table>
										<tr>
											<td>Conexión 1</td>
											<td>Conexión 2</td>
										</tr>
										<tr>
											<td>
<pre>
set transaction isolation level 
serializable 


select * from alumnos 
(No se ve el cambio, sería lectura no repetible)
delete from alumnos where nombre='nom1'
<i><b>ORA-08177:</b>can't serialize access for this transaction</i>
rollback
</pre>
											</td>
											<td>
<pre>


insert into alumnos values ('5','nom5')
commit
</pre>
											</td>
										</tr>
									</table>
								</p>
								<!-- Bloqueos no automáticos -->
								<h2>Bloqueos no automáticos</h2>
								<p>
									Los niveles de aislamiento bloquean aitmáticamente filas, campos o tablas; pero también pueden bloquearse manualmente. 
									Bloqueo de una tabla completa:
									<blockquote>
										<code>
											lock table TABLA <strong>in exclusive mode</strong>
										</code>
									</blockquote>
									Bloqueos de algunas filas: 
									<blockquote>
										<code>
											select %consulta que devuelva algunas filas de una tabla% <b>for update</b>
										</code>
									</blockquote>
								</p>
								<!-- Detección y solución de sesiones bloqueadas -->
								<h2>Detección y solución de sesiones bloqueadas</h2>
								<p>
									Si un usuario/aplicación se comporta de manera inadecuada, puede bloquear la base de datos, es necesario monitorizar los bloqueos y solucionarlos: 
									<ul>
										<li>Avisando al usuario</li>
										<li>Modificando la aplicación</li>
										<li>Matando las transacciones o conexiones bloqueantes</li>
									</ul>
									<!-- Vistas de sesiones -->
									<h3>Vistas de sesiones</h3>
									<p>
										Contiene información de las sesiones 
										<ul>
											<li>Usuario Oracle</li>
											<li>Usuario de sistema operativo</li>
											<li>Cliente Oracle</li>
											<li>Sentencia SQL</li>
										</ul>

									</p>
									<ul>
										<li> v_$session </li>
										<li> v_$process </li>
										<li> V_$SQLTEXT </li>
										<li> V_$LOCK </li>
										<li> V_$LOCKED_OBJECT   </li>
										<li> V_$SESS_IO5 </li>
									</ul>
									<!-- Usuarios conectados 1 -->
									<h3>Usuarios conectados</h3>
									<p>
<pre>
select username,osuser,terminal
from sys.v_$session
where username is not null
order by username,osuser;
</pre>
									</p>
									<!-- Usuarios conectados 2 -->
									<h3>Usuarios conectados - 2</h3>
									<p>
<pre>
select s.username, s.program, s.logon_time
form sys.v_$session s, sys.v_$process p, sys.v_$sess_io si
WHERE s.paddr = p.addr(+) 
AND si.sid(+) = s.sid 
AND s.type = ’USER’;
</pre>										
									</p>
									<h3>Bloqueos de la base de datos</h3>
									<p>
<pre>
select session_id "sid",SERIAL#  "Serial",
  substr(object_name,1,20) "Object",
  substr(os_user_name,1,10) "Terminal",
  substr(oracle_username,1,10) "Locker",
  nvl(lockwait,’active’) "Wait",
  decode(locked_mode,2, ’row share’,3, ’row exclusive’,4, ’share’,5, ’share row exclusive’,6, ’exclusive’,  ’unknown’) 
  "Lockmode",OBJECT_TYPE "Type"
FROM SYS.V_$LOCKED_OBJECT A,
  SYS.ALL_OBJECTS B,
  SYS.V_$SESSION c
WHERE A.OBJECT_ID = B.OBJECT_ID
AND C.SID = A.SESSION_ID
ORDER BY 1 ASC, 5 Desc;
</pre>										
									</p>
									<h3>Descripción de usuarios bloqueados y bloqueantes.</h3>
									<p>
<pre>
select s1.username || ’@’ || s1.machine|| ’ ( SID=’ || s1.sid || ’ )  is blocking ’
|| s2.username || ’@’ || s2.machine || ’ ( SID=’ || s2.sid || ’ ) ’AS blocking_status
from v_$lock l1, v_$session s1, v_$lock l2, v_$session s2 
where s1.sid=l1.sid
and s2.sid=l2.sid
and l1.BLOCK=1
and l2.request > 0
and l1.id1 = l2.id1
and l2.id2 = l2.id2 ;
</pre>										
									</p>
									<!-- Sentencia SQL bloqueada -->
									<h3>Sentencia SQL bloqueada (de un SID)</h3>
									<p>
<pre>
select s.sid, q.sql_text
from v_$sqltext q, v_$session s
where q.address = s.sql_address
and s.sid =<strong>*ELSIDBLOQUEADO*</strong>
order by piece;
</pre>										
									</p>
									<!-- Sentencias SQL bloqueadas 2 -->
									<h3>Sentencias SLQ bloqueadas</h3>
									<p>
<pre>
select s.sid, q.sql_text
from v_$sqltext q, v_$session s
where q.address = s.sql_address
and s.sid in (
  selects2.sid from v_$lock l1, v_$session s1, v_$lock l2, v_$session s2
  where s1.sid=l1.sid
  and s2.sid=l2.sid
  and l1.BLOCK=1 
  and l2.request > 0
  and l1.id1 = l2.id1
  and l2.id2 = l2.id2
  )
order by piece;
</pre>										
									</p>
									<h3>Terminar una sesión</h3>
									<p>
<pre>
SELECT s.inst_id,s.sid,s.serial#,p.spid,s.username,s.program
FROM gv_$session s
JOIN gv_$process p
ON p.addr = s.paddr
AND p.inst_id = s.inst_id
WHERE s.type != ’BACKGROUND’;

alter system kill session 'sid, serial#';
</pre>										
									</p>
									<h3>Terminar una sesión (sistema operativo)</h3>
									<p>
										Solo como último recurso, mejor KILL SESSION 
										se debe matar el proceso identificando en el spid (system process identifier)
										Importante: 
										<ul>
											<li>El spid del proceso intermedio entre el cliente (application code) y el servidor (system global area)</li>
											<li>Por tanto, el proceso a matar se encuentra en el mismo host que el servidor de base de datos.</li>
										</ul>
									</p>
								</p>
							</article>
							<article id="exportarEimportar">
								<h2>Exportar e importar</h2>
								<p>
									<ul>
										<li><a href="#exportacion">Exportación de datos</a></li>
										<li><a href="#importacion">Importación de datos</a></li>
										<li><a href="#ejercicios">Ejercicios</a></li>
										<li><a href="otrassoluciones">Otras soluciones</a></li>
									</ul>
								</p>
								<!-- Exportación -->
								<h2 id="exportacion">Exportación</h2>
								<p>
									Se usa el comando <code>expdp</code> <br>
									Para obtener ayuda del comando use: <code>expdp help=yes</code>. <hr>
									Es necesario crear antes el directory de <strong>Oracle</strong>.
									Ejemplo de exportación:
									<p>
									<code>
										expdp scott/tiger DIRECTORY=dirdmp DUMPFILE=scott.dmp SCHEMAS=scott LOGFILE=scott.log
									</code>
									</p>
									Valores válidos para la exportación:
									<blockquote>
											directory <br>
											dumpfile <br>
											include <i>=TABLE_DATA</i>  -- <strong>example</strong> <br>
											logfile <br>
											query <i>=employees:"WHERE department_id &gt; 10"</i> -- <strong>example</strong><br>
											remap_data <i>=EMPORIO.market:BOSS.market</i> <br>
											schemas <br>
											tables <i>=HR.EMPLOYEES, SH.SALES:SALES_2019</i><br>
											tablespace <br>
									</blockquote>
								</p>
								<!-- Directory  de Oracle -->
								<h3>directory de Oracle</h3>
								<p>
									Algunos comandos de <b>Oracle</b> necesitan trabajar sobre directorios del disco, a veces, no interesa que los usuarios conozcan/decidan los directorios para:
									<ul>
										<li>no llenar una partición</li>
										<li>no divulgar información de la base de datos</li>
										<li>no acceder a directorios donde <b>Oracle</b> puede, pero el usuario no</li>
									</ul>
									<h4>Definir un directorio</h4>
									<p>
										<code>
											grant create any directory to EL_USUARIO;
										</code>
										<code>
											create directory MI-DIRECTORIO to EL_USUARIO;
										</code>
									</p>
									Ejemplo de exportación.
									<blockquote>
										[ CHUNCHE95@centosASGBD -] ~ expdp alumno/alumno directory=midir schemas=alumno dumpfile=alumno.dmp logfile=alumno.log 
									</blockquote>
								</p>
								<!-- Importación -->
								<h2 id="importacion">Importación</h2>
								<p>
									Se usa el comando <code>impdp</code> <br>
									Ayuda con <code>impdp help=yes</code>. 
									Ejemplo de importación de los datos:
									<p>
										<code>
											impdp scott/tiger DIRECTORY=dirdmp DUMFILE=scott.dmp LOGFILE=scoot.log 
										</code>
									</p>
									Valores válidos para la importación en Oracle:
									<blockquote>
										directory <br>
										dumpfile <br>
										exclude <i>=schema:"='HR'"</i> <b>-- example</b> <br>
										full <br>
										include <i>=TABLE_DATA</i> <b>-- example</b> <br>
										logfile <br>
										query <i>=employees:"WHERE department_id &gt 10"</i> <b>-- example</b> <br>
										remap_data <i>=EMPORIO.EMPNO:BOSS.EMPNO</i> <b>-- example</b> <br>
										remap_datafile <br>
										remap_schema <b>IMPORTANTE</b> <br>
										remap_tablespace <br>
										schemas <br>
										tables_exist_action (Opciones: append, replace, skip (por defecto), truncate) <br>
										tables <br>
										tablespaces <br>
									</blockquote>
								</p>
								<h4>Importar un schema en <b>otro usuario</b></h4>
								<p>
									Importar un fichero del usuario <i>profesor</i> en el usuario <i>alumno</i>: 
									<br>
									<code>
										impdp system/alumno schemas=alumno remap_schema=profesor:alumno directory=EXPORTDIR dumpfile=profesor.dmp logfile=profesor.log
									</code> <hr>
									<strong>
										<blockquote>
											Permiso para cambiar schema: <code>grant import full database to YOURUSER;</code>
										</blockquote>
									</strong> <hr>
								</p>
							<!-- Ejercicios -->
								<h2 id="ejercicios">Ejercicios</h2>
								<h3>Primero</h3>
								<p>
									- Cargar <i>multas.sql</i>  <br>
									- Exportar la BD al fichero /datos/export/multas.dmp  <br>
									- Importar las tablas en el usuario <i>copiamultas</i>
								</p>
								<h3>Segundo</h3>
								<p>
									- Crear usuario CARRERAS y ejecutar el script siguiente <br>
									- Cargar los datos <i>coches.sql</i> <br>
									- Exportar las tablas del usuario CARRERAS al fichero CARRERAS.dmp <br>
									- Borrar las filas de la tabla CARRERAS.RESULTADOS <br>
									- Importar los datos desde carreras.dmp 
								</p>
							<!-- Otras soluciones-->
								<h2 id="otrassoluciones">Otras soluciones</h2>
								<p>
									<ul>
										<li>
											RMAN
										</li>
										<li>
											Copia de tablespaces
										</li>
									</ul>
								</p>
							</article>
							<article id="scripts" >
								<h2>Scripts de shell para Oracle.</h2>
								<p>
									<ul>
										<li><a href="#introScripts">Introducción</a></li>
										<li><a href="#shell">Scripts de shell</a></li>
										<li><a href="#entorno">Entorno inicial</a></li>
										<li><a href="#prerrequisitos">Prerrequisitos</a></li>
										<li><a href="#sql">Ejecución de SQL desde la shell</a></li>
										<li><a href="#arranqueparada">Arranque y parada</a></li>
										<li><a href="#operaciones">Operaciones periódicas</a></li>
									</ul>
								</p>
								<!-- Introducción a Scripts en Oracle con la shell en Centos 7 -->
								<h2 id="introScripts">Introducción</h2>
								<p>
									Muchas de las tareas del mantenimiento de una base de datos <strong>Oracle</strong> se llevan a cabo desde la línea de comandos.
									Por lo tanto, pueden automatizarse:
									<ul>
										<li>Arranque y parada</li>
										<li>Extracciones</li>
										<li>Copia de seguridad de datos</li>
										<li>Restauración de datos</li>
									</ul>
									Para ello, se usan las facilidades de ejecución del sistema operativo aprendidas en otros módulos.
								</p>
								<!-- Scripts de shell -->
								<h2 id="shell">Scripts de shell</h2>
								<p>
									<!-- shebang -->
									<h3>Shebang</h3>
									<p>
										Los scripts empiezan con una línea indicando el intérprete que los ejecutará, con un comentario <strong>#!</strong>
										<p><code>
											#!/bin/sh
										</code></p>
										<p><code>
											#!/bin/php
										</code></p>
										<p><code>
											#!/bin/python
										</code></p>
									</p>
									<!-- variables -->
									<h3>Variables</h3>
									<p>
										<blockquote>
											<i>
												# Variable local a esta shell
											</i> <br>
												<code>
													variable=valor <br>
												</code>
											<i>
												# Variable exportada a los hijos de esta shell 
											</i> <br>
												<code>
													<b>export</b> variable_exportada=valor <br>
												</code>
											<i>
												# Variable definida solo para un comando 
											</i> <br>
												<code>
													variable-para-un-comando=valor <b>comando</b>
												</code>
										</blockquote>
									</p>
									<!-- Entrada/salida -->
									<h3>Entrada/salida</h3>
									<p>
										Los programadas comienzan su ejecución con una salida y una entrada, son flujos de bytes, inicialmente:
										<ul>
											<li>La entrada es el teclado</li>
											<li>La salida es la consola</li>
										</ul>
									</p>
									<!-- Redirigir la entrada/salida a fichero -->
									<h3>Redirigir entrada/salida a fichero</h3>
									<p>
										<blockquote>
											<i>
												# La entrada sale de un fichero en vez del teclado
											</i> <br>
											<code>
												sort &lt; fichero
											</code> <br>
											<i>
												# La entrada sale de un fichero y la salida va a otro fichero 
											</i> <br>
											<code>
												sort &lt; fichero &gt; fichero_ordenado
											</code> <br>
											<i>
												# La entrada sale de un fichero y la salida se agrega al final de un fichero 
											</i> <br>
											<code>
												sort &lt; otro_fichero &gt;&gt; fichero_ordenado 
											</code> <br>
											<i>
												# La salida del primer comando es la entrada del segundo 
											</i> <br>
											<code>
												sort &lt; fichero <strong>| less</strong>
											</code>
										</blockquote>
									</p>
									<!-- Heredocs -->
									<h3>Heredocs</h3>
									<p>
										<pre><code><i># Entrada se especifica en el propio script</i>
sort &lt;&lt; FINDEFICHERO
Maria
Pepe
Juan
Susana
Manolo 
FINDEFICHERO</code></pre>
									</p>
									<!-- Salida como parámetro -->
									<h3>Salida como parámetro</h3>
									<p>
										Se puede capturar la salida de un comando en una cadena, esa cadena se usa luego como otra cualquiera en el script. <br>
										<code>
											# defino una variable con los ficheros del directorio <br>
											variable=$(ls)
										</code>
									</p>
									<!-- Parámetros del script -->
									<h3>Parámetros del script</h3>
									<p>
										<ul>
											<lo>
												<i>$0:</i> El nombre del script.
											</lo>
											<lo>
												<i>$1:</i> Primer parámetro.
											</lo>
											<lo>
												<i>$2:</i> Segundo parámetro.
											</lo>
											<lo>
												<i>$*:</i> Todos los parámetros a partir del primero.
											</lo>
										</ul>
									</p>
									<!-- Funciones -->
									<h3>Funciones</h3>
									<p>
										Son conjuntos agrupados de órdenes con un nombre. Tienen sus propios argumentos: $*, $1, $2, ... <br>
										<pre><code>importante(){
echo ---------
echo Aviso: $*
echo ---------
}

importante "Así se define una función en bash"</code></pre>
									</p>
									<!-- Código de error (exit code) -->
									<h3>Código de error (exit code)</h3>
									<p>
										Al terminar, un programa devuelve un valor numérico, por convenio:
										<ul>
											<li>0: Todo ha funcionado correctamente.</li>
											<li>Distinto de 0: Ha sucedido algún tipo de error.</li>
										</ul>
										Se puede consultar con <code>$?</code> <strong>inmediatamente</strong> después de ejecutar el comando. <br>
										<pre><code> grep cadena * 
exit_code_del_grep=$? 
echo grep a devuelto: $exit_code_del_grep</code></pre>
									</p>
									<!-- Bucles -->
									<h3>Bucles</h3>
									<p>
										Con <i>for</i> se pueden hacer bucles sobre una lista de parámetros, para bucles numéricos se puede usar el comando <code>seq</code>. 
										<pre><code>for nombre in maria juan pepe susana manolo 
do 
  echo Realizando una vuelta de bucle sobre $nombre 
done 
<i># Cuidado con los nombres de fichero con espacio </i>
for fichero in $(ls) 
do 
  echo El siguiente fichero es $fichero 
done</code></pre>
									</p>
									<!-- Condiciones -->
									<h3>Condiciones</h3>
									<p>
										<code>if</code> utiliza los códigos de error de los programas.
										<ul>
											<li>0 se considera <i>true</i></li>
											<li>Cualquier otro valor se considera <i>false</i></li>
										</ul>
										<pre><code> if grep cadena * 
then 
	echo grep ha encontrado algo sin errores 
else 
	echo grep no lo ha encontrado, o ha habido errores
fi</code></pre>
									</p>
									<!-- return en funciones -->
									<h3>return en funciones</h3>
									<p>
										Las funciones también tienen código de retorno. Pueden simplificar <code>if</code> o bucles <code>while</code>. 
										<pre><code>condicion(){ 
# Aquí se podría decidir el retorno con otros comandos 
# o con if's encadenados, pero como ejemplo devolvemos TRUE.
<strong>return 0</strong>
}

while condicion 
do 
	echo Esto es un bucle infinito 
done</code></pre>
									</p>
									<!-- Comando [ -->
									<h3>Comando [</h3>
									<p>
										[ es un comando externo que ayuda a hacer condiciones con <code>if</code> 
										<ul>
											<li>Comparación de cadenas</li>
											<li>Comparación de números</li>
											<li>Existencia de ficheros</li>
										</ul>
										<pre><code>TEST(1)
TEST(1) 
NAME 
	test -  check file types and compare values 
SYNOPSIS 
	test EXPRESSION 
	test 
	[ EXPRESSION ] 
	[ ]
	[ OPTION ] </code></pre>
									</p>
									<!-- Operaciones aritméticas -->
									<h3>Operaciones aritméticas</h3>
									<p>
										Se usa $((expresión))
										<pre><code> # Incrementar la variable contador
contador = $(($contador + 1)) </code></pre>
									</p>
									<!-- Comandos útiles -->
									<h3>uniq - Comando para borrar repetidos</h3>
									<p>
										El comando <code>uniq</code> sirve para eliminar las repeticiones de una lista, ejemplo: 
										<pre><code> uniq &lt;&lt; EOF
hola
hola
adios 
hola 
EOF 
</code></pre> 
										Pero esto solo funciona si los string están juntos, para que funcione bien, debemos pararlo con un <code>sort</code>, ejemplo:
										<pre><code>mi_uniq(){
  sort | uniq 
}
mi_uniq &lt;&lt;EOF 
hola 
adios 
hola 
hola 
chao 
hola
</code></pre>
									</p>
									<h3>Enviar un email</h3>
									<p>
										<code>
											echo CUERPO DEL MENSAJE | mail -s "Asunto del mensaje" -a FICHERO_ADJUNTO maildechunche@gmail.com
										</code>
									</p>
									<!-- Operaciones matemáticas, si no se dispone de bash -->
									<h3>Operaciones matemáticas, si no se dispone de bash</h3>
									<p>
										<code>echo 2+2 | bc</code>
									</p>
									<!-- Text User Interface -->
									<h3>Text User Interface</h3>
									<p>
										whiptail o dialog
									</p>
								</p>
								<h2 id="entorno">Entorno inicial</h2>
								<p>
									bash procesa los siguientes ficheros: 
									<ul>
										<ol>
											Si un nuevo <i>login:</i> /etc/bash.bashre (Debian), /etc/bashrc (Centos), ~/.bash_login
										</ol>
										<ol>
											Siempre: /etc/profile ~/.bashrc
										</ol>
									</ul>
									Así, se puede conseguir que:
									<ul>
										<li>Se ejecuten comandos al entrar a un sistema</li>
										<li>Se ejecuten comandos en cadena nueva shell</li>
										<li>Se ejecuten comandos para todos los usuarios</li>
									</ul>
									<!-- Ejercicios -->
									<h3>Ejercicios</h3>
									<ul>
										<ol>1. Haz que el usuario 'alumno' tenga las variables necesarias para usar ORACLE cada vez que hace login.</ol>
										<ol>2. Haz que el usuario 'alumno' vea el estado del listener cada vez que inicia una shell.</ol>
										<ol>3. Haz que todos los usuarios vean el mensaje 'Bienvenido a ASGBD' cada vez que inician una shell.</ol>
										<ol>4. Crea un script en $HOME/estado.sh que muestre el valor de las variables HOME, USER, PATH. ORACLE_HOME, ORABLE_SID, ORACLE_BASE y la hora actual.</ol>
									</ul>
								</p>
								<!-- Prerrequisitos -->
								<h2 id="prerrequisitos">Prerrequisitos</h2>
								<p>
									Los comandos de <strong>Oracle</strong> necesitan conocer a qué instancia hacen referencia, para ello, necesitan las variables de entorno ORACLE_HOME y ORABLE_SID, también, es conveniente añadir los 
									comandos de <strong>Oracle</strong> al path. El siguiente script puede usarse para tener estas variables (ejecutándolo con <code><strong>source</strong></code> )
									<pre><code>#!/bin/sh 
ORACLE_HOME=/var/oracle/product/18.1.0/asir_bbdd
ORACLE_SID=asir
PATH=$ORACLE_HOME/bin:$PATH
export ORACLE_HOME
export ORACLE_SID
export PATH	</code></pre>
									<!-- Autenticación -->
									<h3>Autenticación de SQLPLUS</h3>
									<p>
										SQLPlus se autentica/autentifica de varias formas.
										<ul>
											<li>Mediante Oracle: usuarios creados con <code>create user ...</code></li>
											<li>Mediante el sistema operativo: Al instalar, se indica un grupo de usuarios que Oracle considera autenticados (Grupo wheel)</li>
										</ul>
										SQLPlus con autenticación de sistema operativo.
										<pre><code>show parameter os_authent_prefix; -- Por defecto es 'ops$'
create user ops$usuario identified externally;
#+end_src_ 

#+begin_src sh 
su usuario 
sqlpñus / 
 </code></pre>
									</p>
									<!-- SQLPlus con autenticación de Oracle -->
									<h3>SQLPlus con autenticación de Oracle</h3>
									<p>
										<code>
											sqlplus sys/alumno as sysdba
										</code>
									</p>
									<!-- Conexiones de SQLPlus -->
									<h3>Conexiones de SQLPlus</h3>
									<p>
										Hasta ahora: 
										<ul>
											<li>todas las conexiones de SQLPlus son locales, sin utilizar la red</li>
											<li>todas las conexiones de SQLDeveloper son por red</li>
										</ul>
										Para conectar por red con SQLPlus se usa un descriptor de conexión
										<ul>
											<li>Los descriptores están en el fichero <i>tnsnames.ora</i></li>
										</ul>
										<code>
											sqlplus sys/alumno@CONEXION as sysdba
										</code>
									</p>
									<!-- tnsnames.ora -->
									<h3>tnsnames.ora</h3>
									<p>
<pre>MYSID- 
  (DESCRIPTION -
	(ADDRESS_LIST - 
	  (ADDRESS - (PROTOCOL-TCP) (HOST-mydnshostname) (PORT-1521))
	)
	(CONNECT_DATA - 
		(SERVICE_NAME - MYSID)
	)
  )</pre>
										Situado en $ORACLE_HOME/network/admin/ <br>
										Indica las formas de conexión a instancias de base de datos 
										<ul>
											<li>Protocolo de conexión: TCP</li>
											<li>Dirección IP</li>
											<li>Puerto</li>
											<li>SID</li>
										</ul>
										Equivalen a la lista de conexiones de SQLDeveloper
									</p>
									<!-- Conexiones sin tnsnames.ora -->
									<h3>Conexiones sin tnsnames.ora</h3>
									<p>
										No es necesario cambiar el fichero <i>tnsnames.ora</i> para conectarse a un servirdor remoto, aunque puede ser recomendable. Ejemplo: varios scripts usan un nombre de conexión, 
										de forma que pueda cambiarse fácilmente. <br>
										<code>sqlplus username/password@host:port/sid</code>
									</p>
								</p>
								<!-- Ejecución de SQL desde la shell -->
								<h2 id="sql">Ejecucuón de SQL desde la shell</h2>
								<p>
									El comando <code>sqlplus</code> puede ejecutarse desde la shell. Lee las órdenes SQL desde la entrada estándar. 
									<!-- ejemplo de heredoc -->
									<h3>Ejemplo <i>heredoc</i></h3>
									<p>
										<pre><code>
sqlplus -S alumno/alumno &lt;&lt;HEREDOC
set autocommit off
create table prueba (un-atributo int);
insert into prueba values (1);
insert into prueba values (2);
rollback;
HEREDOC </code></pre>
									</p>
									<!-- Consultas a fichero -->
									<h3>Consultas a fichero</h3>
									<p>
										Puede enviarse la salida a un fichero. 
<pre><code>sqlplus -S alumno/alumno &lt;&lt;HEREDOC
set autocommit off
insert into prueba values(1);
insert into prueba values(2);
spool prueba.txt 
select * from prueba;
spool off
rollback;
HEREDOC

less prueba.txt</code></pre>
									</p>
									<!-- Formateo básico de salida -->
									<h3>Formateo básico de la aslida</h3>
									<p>
										Tiene algunas facilidades para formatear la salida (por ejemplo, para generar ficheros CSV).
<pre><code>sqlplus -S sys/alumno as sysdba &lt;&lt;HEREDOC 
set solsep ','  -- sapara solumnas con una coma 
set pagesize 0  -- sin repetición de las cabeceras de las filas
set trimspool on -- Elimina los espacios en blancos 
set headsep off --  Quizas no sea muy útil 
set linesize 1000 -- Ancho de la página

spool tablas.csv 

select table_name, tablespace_name 
  from all_tables
  where owner = 'SYS'
	and tablespace_name is not null;
spool off
HEREDOC   
</code></pre>										
									</p>
									<!-- Script SQL para sqlplus -->
									<h3>Script SQL para sqlplus</h3>
									<p>
										<code>sqlplus</code> también puede leer script de SQL con <code>@</code>. <br>
<pre><code>sqlplus -S sys/alumno as sysdba &lt;&lt; HEREDOC
@/camino/al/fichero.sql 
HEREDOC
</code></pre>										
									</p>
								</p>
								<!-- Arranque y parada -->
								<h2 id="arranqueparada">Arranque y parada</h2>
								<p>
									<!-- dbstart y /etc/oratab -->
									<h3>dbstart y /etc/oratab</h3>
									<p>
										<strong>Oracle</strong> proporciona el script dbstart para arrancar instancias de base de datos, se guía por el comando de /etc/oratab
										Por alguna razón, 
										<ul>
											<li>no levanta el listener </li>
											<li>no hace <code>startup open</code>, así que no se registra en el listener</li>
											<li>se puede modificar el script para que lo haga</li>
										</ul>
										<blockquote>
											<code>
												asir:/var/oracle/product/18.0.1/asir_bbdd: <strong>Y</strong>
											</code>
										</blockquote>
									</p>
									<!-- Ejecutar Oracle al iniciar el sistema -->
									<h3>Ejecutar Oracle al iniciar el sistema</h3>
									<p>
										Cada sistema operativo tiene sus formas de arrancar servicios/demonios al inicio 
										<ul>
											<li>
												<strong>Windows</strong> Servicios
											</li>
											<li>
												<strong>Linux</strong>
												<ul>
													<li>
														<b>systemd:</b> Ficheros en el directorio /etc/systemd/system. Se controla con la orden <code>systemctl</code>
													</li>
													<li>
														<b>rc init:</b> Se basaba en scripts en los directorios /etc/rc.*. Se está reemplazando por <b>systemd</b>
													</li>
												</ul>
											</li>
										</ul>
									</p>
									<!-- systemd -->
									<h3>systemd</h3>
									<p>
										Los servicios se crean con ficheros en <code>/etc/systemd/system</code> (entre otros)
										<ul>
											<li>Dependen de otros ficheros (After)</li>
											<li>Otros servicios dependen de ellos (WantedBy)</li>
											<li>Se puede elegir el usuario que lo lanza (User)</li>
										</ul>
<pre><code>[Unit]
Description=Oracle 
After=network.target 

[Service]
Type=forking 
User=alumno
ExecStart=/home/alumno/oracleInit.sh
ExecStop=/home/alumno/oracleStop.sh 

[Install]
WantedBy=multi-user.target</code></pre>	
										Más información con <code>man systemd.service</code> y <code>man systemd.unit</code>
									</p>
									<!-- Dependencias de la sección Unit -->
									<h3>Dependencias de la sección Unit</h3>
									<p>
										<table>
											<tr>
												<td>
													Si el servicio A ...
												</td>
												<td>
													A intenta arrancar B
												</td>
												<td>
													Si se apaga B, A también
												</td>
												<td>
													A arranca si B está inicialmente apagado
												</td>
												<td>
													Si falla arranque de B, arranca A
												</td>
											</tr>
											<tr>
												<td>
													BindsTo=B
												</td>
												<td>
													Sí
												</td>
												<td>
													Sí
												</td>
												<td>
													Sí
												</td>
												<td>
													No
												</td>
											</tr>
											<tr>
												<td>
													Requires=B
												</td>
												<td>
													Sí
												</td>
												<td>
													No*
												</td>
												<td>
													Sí
												</td>
												<td>
													No
												</td>
											</tr>
											<tr>
												<td>
													Requisite=B
												</td>
												<td>
													No
												</td>
												<td>
													No
												</td>
												<td>
													No
												</td>
												<td>
													No
												</td>
											</tr>
											<tr>
												<td>
													Wants=B
												</td>
												<td>
													Sí
												</td>
												<td>
													No
												</td>
												<td>
													Sí
												</td>
												<td>
													Sí
												</td>
											</tr>
										</table>
										<i>Fuente:</i> <a href="https://www.freedesktop.org/software/systemd/man/systemd.unit.html" target="_blank" rel="noopener noreferrer">freedesktop</a> <br>
										[*] Si B se apaga examplícitamente, se apaga A. Si el servicio B termina sin error, no se apaga A.
										
										<!-- Dependencias de la sección Install -->
										<h4>Dependencias de la sección Install</h4>
										<p>
											Si el servicio A 
											<table>
												<tr>
													<td>WantedBy=B</td>
													<td>Equivalente a que B indique Wants=A</td>
												</tr>
												<tr>
													<td>RequiredBy=B</td>
													<td>Equivalente a que B indique Required=A</td>
												</tr>
											</table>
										</p>
										<!-- Controlar el arranque de servicios -->
										<h4>Controlar el arranque de servicios</h4>
										<p>
											Habilitar/deshabilitar un servicio al inicio del sistema. 
											<code>
												systemctl enable SERVICIO 
											</code>
											<code>
												systemctl disable SERVICIO
											</code>
										</p>
										<!-- Arrancar o parar un servicio -->
										<h4>Arrancar o parar un servicio</h4>
										<p>
											<code>systemctl start SERVICIO</code>
											<code>systemctl stop SERVICIO</code>
										</p>
										<!-- Recargar ficheros -->
										<h4>Recargar ficheros</h4>
										<p>
											Si se crean nuevas unidades, no se tienen en cuenta automáticamente, se necesita <code>systemctl daemon reload</code>
										</p>
										<!-- Servicios de usuario -->
										<h4>Servicios de usuario</h4>
										<p>
											El comando <code>systemctl</code> se ejecuta con el parámetro <code>system</code> por defecto <br>
											<li>Servicios de sistema.</li>
											Si se ejecuta con <code>user</code> se usan los servicios del usuario llamante
											<li>Sus unidades están en $HOME/.config/systemd/user/</li>
										</p>
										<!-- Runlevels y targets -->
										<h4>Runlevels y targets</h4>
										<p>
											<table>
												<tr>
													<td>Runlevel</td>
													<td>Target</td>
													<td>Alias</td>
												</tr>
												<tr>
													<td>0</td>
													<td>poweroff.target</td>
													<td>runlevel0.target</td>
												</tr>
												<tr>
													<td>1</td>
													<td>rescue.target</td>
													<td>runlevel1.target</td>
												</tr>
												<tr>
													<td>3</td>
													<td>multi user.target</td>
													<td>runlevel3.target</td>
												</tr>
												<tr>
													<td>5</td>
													<td>graphical.target</td>
													<td>runlevel5.target</td>
												</tr>
												<tr>
													<td>6</td>
													<td>reboot.target</td>
													<td>runlevel6.target</td>
												</tr>
											</table>
										</p>
										<!-- Utilidades systemd -->
										<h4>Utilidades systemd</h4>
										<p>
											<ul>
												<li><code>systemd analyze plot:</code> Tiempo de carga de cada servicio</li>
												<li><code>systemd analyze dot:</code> Fichero con todas las dependencias. Puede convertirse en SVG con dot Tsvg o nombre dibujo.svg </li>
												<li><code>systemctl list dependencies:</code> Servicios necesarios para cargar un servicio. Se pueden listar a la inversa con <code>reverse</code></li>
											</ul>
										</p>
									</p>
								</p>
								<!-- Operaciones periódicas -->
								<h2 id="operaciones">Operaciones periódicas</h2>
								<p>
									Los sistemas operativos aportan formas para ejecutar tareas periódicamente
									<ul>
										<li>Windows: tiene las tareas programadas</li>
										<li>Linux: tiene el sistema cron y systemd</li>
									</ul>
									<!-- cron -->
									<h3>cron</h3>
									<p>
										Es un servicio que: 
										<ul>
											<li>Lee el fichero /etc/crontab</li>
											<li>Ejecuta las órdenes descritas en ese fichero</li>
											<li>Más información en la <a href="https://es.wikipedia.org/wiki/Cron_(Unix)#Formato_del_fichero_crontab" target="_blank" rel="noopener noreferrer">Wikipedia</a></li>
										</ul>
										Suele utilizar el comando <code>run parts</code>
										<ul>
											<li>Este comando ejecuta todos los comandos de un directorio</li>
											<li>Más info con <code>man run parts</code></li>
										</ul>
									</p>
									<!-- systemd -->
									<h3>systemd</h3>
									<p>
										Más información en <code>man systemd.timer</code> y <code>man systemd.time</code>
<div>
<pre><code>[Unit]
Description=Print date into /tmp/date file 

[Service]
Type=oneshot
ExecStart=/usr/bin/sh -c '/usr/bin/date &gt;&gt; /tmp/date'</code></pre>	
/etc/systemd/system/date.service
</div>
<div>
<pre><code>[Unit]
Description=Run date.service every 10 minutes 

[Timer]
OnCalendar=*:0/10
</code></pre>
/etc/systemd/system/date.timer
</div>
									</p>
									<!-- Operaciones periódicas manuales -->
									<h3>Operaciones periódicas manuales</h3>
									<p>
										Se puede crear un bucle infinito con sleep, el bucle se interrumpe con alguna condición externa, por ejemplo, que exista o deje de existir un fichero. 
<pre><code>#!/bin/bash 
em $HOME/bucledebeparar 
continua(){
	if [ -e $HOME/bucledebeparar ]
	then 
		return 1
	else
		retunr 0 
	fi
}
SEGUNDOS=5
sleep $SEGUNDOS
white continua 
do 
	echo Han pasado $SEGUNDOS segundos 
	sleep $SEGUNDOS
done
</code></pre>										
									</p>
								</p>
							</article>
						<!-- About -->
							<article id="about">
								<h2 class="major">Acerca de mi.</h2>
								<span class="image main"><img src="images/humancomputing3.0.png" alt="" /></span>
								<p>
										Bienvenido a la extensión HC Learning Web de Human Computing 3.0, es el sitio web donde encontrarás diversas formas de crecer y desarrollarte sin dificultad, siguiendo los pasos descritos.
										Aquí mantenemos la información de interés y cuidando la sencilles para que sea fácil y sencillo de seguir. Es hora de empezar. <br>
										Adelante.
										<a href="index.html">Inicio</a>
								</p>
							</article>

						<!-- Contact -->
							<article id="contact">
								<h2 class="major">Contacto </h2>
								<form method="post" action="#">
									<div class="fields">
										<div class="field half">
											<label for="name">Name</label>
											<input type="text" name="name" id="name" />
										</div>
										<div class="field half">
											<label for="email">Email</label>
											<input type="text" name="email" id="email" />
										</div>
										<div class="field">
											<label for="message">Message</label>
											<textarea name="message" id="message" rows="4"></textarea>
										</div>
									</div>
									<ul class="actions">
										<li><input type="submit" value="Send Message" class="primary" /></li>
										<li><input type="reset" value="Reset" /></li>
									</ul>
								</form>
								<ul class="icons">
									<li><a href="#" class="icon fa-twitter"><span class="label">Twitter</span></a></li>
									<li><a href="#" class="icon fa-facebook"><span class="label">Facebook</span></a></li>
									<li><a href="#" class="icon fa-instagram"><span class="label">Instagram</span></a></li>
									<li><a href="https://github.com/chunche95" target="_blank"  class="icon fa-github"><span class="label">GitHub</span></a></li>
								</ul>
							</article>
						<!-- Elements 
							<article id="elements">
								<h2 class="major">Elements</h2>

								<section>
									<h3 class="major">Text</h3>
									<p>This is <b>bold</b> and this is <strong>strong</strong>. This is <i>italic</i> and this is <em>emphasized</em>.
									This is <sup>superscript</sup> text and this is <sub>subscript</sub> text.
									This is <u>underlined</u> and this is code: <code>for (;;) { ... }</code>. Finally, <a href="#">this is a link</a>.</p>
									<hr />
									<h2>Heading Level 2</h2>
									<h3>Heading Level 3</h3>
									<h4>Heading Level 4</h4>
									<h5>Heading Level 5</h5>
									<h6>Heading Level 6</h6>
									<hr />
									<h4>Blockquote</h4>
									<blockquote>Fringilla nisl. Donec accumsan interdum nisi, quis tincidunt felis sagittis eget tempus euismod. Vestibulum ante ipsum primis in faucibus vestibulum. Blandit adipiscing eu felis iaculis volutpat ac adipiscing accumsan faucibus. Vestibulum ante ipsum primis in faucibus lorem ipsum dolor sit amet nullam adipiscing eu felis.</blockquote>
									<h4>Preformatted</h4>
									<pre><code>i = 0;

while (!deck.isInOrder()) {
    print 'Iteration ' + i;
    deck.shuffle();
    i++;
}

print 'It took ' + i + ' iterations to sort the deck.';</code></pre>
								</section>

								<section>
									<h3 class="major">Lists</h3>

									<h4>Unordered</h4>
									<ul>
										<li>Dolor pulvinar etiam.</li>
										<li>Sagittis adipiscing.</li>
										<li>Felis enim feugiat.</li>
									</ul>

									<h4>Alternate</h4>
									<ul class="alt">
										<li>Dolor pulvinar etiam.</li>
										<li>Sagittis adipiscing.</li>
										<li>Felis enim feugiat.</li>
									</ul>

									<h4>Ordered</h4>
									<ol>
										<li>Dolor pulvinar etiam.</li>
										<li>Etiam vel felis viverra.</li>
										<li>Felis enim feugiat.</li>
										<li>Dolor pulvinar etiam.</li>
										<li>Etiam vel felis lorem.</li>
										<li>Felis enim et feugiat.</li>
									</ol>
									<h4>Icons</h4>
									<ul class="icons">
										<li><a href="#" class="icon fa-twitter"><span class="label">Twitter</span></a></li>
										<li><a href="#" class="icon fa-facebook"><span class="label">Facebook</span></a></li>
										<li><a href="#" class="icon fa-instagram"><span class="label">Instagram</span></a></li>
										<li><a href="#" class="icon fa-github"><span class="label">Github</span></a></li>
									</ul>

									<h4>Actions</h4>
									<ul class="actions">
										<li><a href="#" class="button primary">Default</a></li>
										<li><a href="#" class="button">Default</a></li>
									</ul>
									<ul class="actions stacked">
										<li><a href="#" class="button primary">Default</a></li>
										<li><a href="#" class="button">Default</a></li>
									</ul>
								</section>

								<section>
									<h3 class="major">Table</h3>
									<h4>Default</h4>
									<div class="table-wrapper">
										<table>
											<thead>
												<tr>
													<th>Name</th>
													<th>Description</th>
													<th>Price</th>
												</tr>
											</thead>
											<tbody>
												<tr>
													<td>Item One</td>
													<td>Ante turpis integer aliquet porttitor.</td>
													<td>29.99</td>
												</tr>
												<tr>
													<td>Item Two</td>
													<td>Vis ac commodo adipiscing arcu aliquet.</td>
													<td>19.99</td>
												</tr>
												<tr>
													<td>Item Three</td>
													<td> Morbi faucibus arcu accumsan lorem.</td>
													<td>29.99</td>
												</tr>
												<tr>
													<td>Item Four</td>
													<td>Vitae integer tempus condimentum.</td>
													<td>19.99</td>
												</tr>
												<tr>
													<td>Item Five</td>
													<td>Ante turpis integer aliquet porttitor.</td>
													<td>29.99</td>
												</tr>
											</tbody>
											<tfoot>
												<tr>
													<td colspan="2"></td>
													<td>100.00</td>
												</tr>
											</tfoot>
										</table>
									</div>

									<h4>Alternate</h4>
									<div class="table-wrapper">
										<table class="alt">
											<thead>
												<tr>
													<th>Name</th>
													<th>Description</th>
													<th>Price</th>
												</tr>
											</thead>
											<tbody>
												<tr>
													<td>Item One</td>
													<td>Ante turpis integer aliquet porttitor.</td>
													<td>29.99</td>
												</tr>
												<tr>
													<td>Item Two</td>
													<td>Vis ac commodo adipiscing arcu aliquet.</td>
													<td>19.99</td>
												</tr>
												<tr>
													<td>Item Three</td>
													<td> Morbi faucibus arcu accumsan lorem.</td>
													<td>29.99</td>
												</tr>
												<tr>
													<td>Item Four</td>
													<td>Vitae integer tempus condimentum.</td>
													<td>19.99</td>
												</tr>
												<tr>
													<td>Item Five</td>
													<td>Ante turpis integer aliquet porttitor.</td>
													<td>29.99</td>
												</tr>
											</tbody>
											<tfoot>
												<tr>
													<td colspan="2"></td>
													<td>100.00</td>
												</tr>
											</tfoot>
										</table>
									</div>
								</section>

								<section>
									<h3 class="major">Buttons</h3>
									<ul class="actions">
										<li><a href="#" class="button primary">Primary</a></li>
										<li><a href="#" class="button">Default</a></li>
									</ul>
									<ul class="actions">
										<li><a href="#" class="button">Default</a></li>
										<li><a href="#" class="button small">Small</a></li>
									</ul>
									<ul class="actions">
										<li><a href="#" class="button primary icon fa-download">Icon</a></li>
										<li><a href="#" class="button icon fa-download">Icon</a></li>
									</ul>
									<ul class="actions">
										<li><span class="button primary disabled">Disabled</span></li>
										<li><span class="button disabled">Disabled</span></li>
									</ul>
								</section>

								<section>
									<h3 class="major">Form</h3>
									<form method="post" action="#">
										<div class="fields">
											<div class="field half">
												<label for="demo-name">Name</label>
												<input type="text" name="demo-name" id="demo-name" value="" placeholder="Jane Doe" />
											</div>
											<div class="field half">
												<label for="demo-email">Email</label>
												<input type="email" name="demo-email" id="demo-email" value="" placeholder="jane@untitled.tld" />
											</div>
											<div class="field">
												<label for="demo-category">Category</label>
												<select name="demo-category" id="demo-category">
													<option value="">-</option>
													<option value="1">Manufacturing</option>
													<option value="1">Shipping</option>
													<option value="1">Administration</option>
													<option value="1">Human Resources</option>
												</select>
											</div>
											<div class="field half">
												<input type="radio" id="demo-priority-low" name="demo-priority" checked>
												<label for="demo-priority-low">Low</label>
											</div>
											<div class="field half">
												<input type="radio" id="demo-priority-high" name="demo-priority">
												<label for="demo-priority-high">High</label>
											</div>
											<div class="field half">
												<input type="checkbox" id="demo-copy" name="demo-copy">
												<label for="demo-copy">Email me a copy</label>
											</div>
											<div class="field half">
												<input type="checkbox" id="demo-human" name="demo-human" checked>
												<label for="demo-human">Not a robot</label>
											</div>
											<div class="field">
												<label for="demo-message">Message</label>
												<textarea name="demo-message" id="demo-message" placeholder="Enter your message" rows="6"></textarea>
											</div>
										</div>
										<ul class="actions">
											<li><input type="submit" value="Send Message" class="primary" /></li>
											<li><input type="reset" value="Reset" /></li>
										</ul>
									</form>
								</section>

							</article>
							-->
						
					</div>

				<!-- Footer -->
					<footer id="footer">
						<p class="copyright">&copy; Human Computing 3.0.&REG; Design: <a href="https://github.com/chunche95">Chunche95</a>.</p>
					</footer>

			</div>

		<!-- BG -->
			<div id="bg"></div>

		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/browser.min.js"></script>
			<script src="assets/js/breakpoints.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>

	</body>
</html>
